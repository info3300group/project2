<!DOCTYPE html>
<meta charset="utf-8" />
<style>
  .map-layer {
    fill: #fff;
    stroke: #aaa;
  }
  #slider-container {
      width: 80%;
      margin: 20px auto;
      position: relative;
  }

    </style>
</style>
<body>
  <svg></svg>
  <div id="slider-container"></div>
    <label for="temp">Currently the year is: <output id="value"></output> </label><br />
    <input id = "slider" type="range" min="2010" max="2017" list="markers" value = "2017" />
  </div>
  <datalist id="markers">
    <option value="2010"></option>
    <option value="2011"></option>
    <option value="2012"></option>
    <option value="2013"></option>
    <option value="2014"></option>
    <option value="2015"></option>
    <option value="2016"></option>
  </datalist>
  <!-- <input id="slider-container" type="range" min="2010" max="2017" /> -->
  <!-- <div id="selected-year">Selected Year: <span id="year-value">2010</span></div> -->
  <!-- <script src="https://d3js.org/d3.v3.min.js"></script> -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <script>
    // YEAR SLIDER
    const input = document.querySelector("#slider");
    const value = document.querySelector("#value");
    value.textContent = "2017"
    input.addEventListener("input", (event) => {
      value.textContent = event.target.value;
      console.log(event.target.value)
    });
    
    // YEAR SLIDER END

    const slider = d3.select('#slider-container').append('input')
        .attr('type', 'range')
        .attr('min', 2010)
        .attr('max', 2017)
        .attr('step', 1)
        .on('input', e => {
          d3.select('#year-value').text(e.target.value)
        })
        .attr('value', 2010)

    //MAP DRAWING AND MOUSE OVER FUNCTIONS
    var width = 960,
      height = 500;

    var colorMap = {
      Bronx: '#ADD8E6', // Light Blue
      Brooklyn: '#4169E1', // Royal Blue
      Manhattan: '#00BFFF', // Deep Sky Blue
      Queens: '#1E90FF', // Dodger Blue
      'Staten Island': '#6495ED', // Cornflower Blue
    };

    const projection = d3
      .geoMercator()
      .scale(45000)
      .center([-73.935242, 40.73061])
      .translate([width / 2, height / 2]);

    // var path = d3.geo.path().projection(projection);
    const pathGenerator = d3.geoPath().projection(projection);

    var svg = d3.select('svg').attr('width', width).attr('height', height);

    var g = svg.append('g');

    var mapLayer = g.append('g').classed('map-layer', true);

    d3.json('nyc.geojson')
      .then(function (mapData) {
        const features = mapData.features;

        mapLayer
          .selectAll('path')
          .data(features)
          .join('path')
          .attr('d', pathGenerator)
          .style('fill', function (d) {
            return colorMap[d.properties.boro_name];
          })
          .on('mouseover', function(_,d) {mouseover(d, this)})
          .on('mouseout', function(_,d) {mouseout(d, this)});
      })
      .catch(function (error) {
        console.error('Error loading GeoJSON:', error);
      });

    function mouseover(d, path) {
      // Highlight hovered borough with orange
      //console.log(d3.select(thing))
      d3.select(path).style('fill', 'rgba(255, 165, 0, 0.3)');
      boroughName
        .text(d.properties.boro_name)
        .attr('font-size', '42px')
        .style('font-family', 'Arial');
    }

    // reset borough color and text
    function mouseout(d, path) {
      d3.select(path).style('fill', function (d) {
        return colorMap[d.properties.boro_name];
      });
      boroughName.text('');
    }

    var boroughName = g.append('text').attr('x', 20).attr('y', 45);

    function drawHeatMap(salesPriceData, currentYear) {

      const currentYearData = Object.keys(salesPriceData).map(
        v => [v, salesPriceData[v][String(currentYear)]])

      const priceExtent = d3.extent(Object.keys(salesPriceData)
        .map(v => Object.keys(salesPriceData[v])
          .map(k => Number(salesPriceData[v][k]))).flat())

      const colors = [
        "mediumaquamarine",
        "skyblue",
        "darkcyan",
        "lightsalmon",
        "orchid"
      ]

      //const colorScale = d3.scaleQuantile().domain(priceExtent).range(colors)

      console.log(currentYearData)
    }

    //MAP DRAWING END
  </script>
</body>
