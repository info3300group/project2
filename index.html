<!DOCTYPE html>
<meta charset="utf-8" />
<style>
  .map-layer {
    fill: #fff;
    stroke: #aaa;
  }
</style>

<body>
  <svg></svg>
  <div id='year_slider_div'></div>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script>
    //MAP DRAWING AND MOUSE OVER FUNCTIONS
    var width = 960,
      height = 500;

    var colorMap = {
      Bronx: "#ADD8E6", // Light Blue
      Brooklyn: "#4169E1", // Royal Blue
      Manhattan: "#00BFFF", // Deep Sky Blue
      Queens: "#1E90FF", // Dodger Blue
      "Staten Island": "#6495ED", // Cornflower Blue
    };

    var projection = d3.geo
      .mercator()
      .scale(45000)
      .center([-73.935242, 40.73061])
      .translate([width / 2, height / 2]);

    var path = d3.geo.path().projection(projection);

    var svg = d3.select("svg").attr("width", width).attr("height", height);

    var g = svg.append("g");

    var mapLayer = g.append("g").classed("map-layer", true);

    d3.json("nyc.geojson", function (error, mapData) {
      d3.json("average_sale_prices.json", function (_, salesPriceData) {

        var features = mapData.features;

        mapLayer
          .selectAll("path")
          .data(features)
          .enter()
          .append("path")
          .attr("d", path)
          .style("fill", function (d) {
            return colorMap[d.properties.boro_name];
          })
          .on("mouseover", mouseover)
          .on("mouseout", mouseout);

        const slider = d3.select('#year_slider_div')
          .append('input')
          .attr('type', 'range')
          .attr('min', 2010)
          .attr('max', 2017)
          .attr('step', 1)
          .on('input', () => {
            drawHeatMap(salesPriceData, event.target.value)
          })
          .attr('value', 2015)


        // init display
        let currentYear = 2010
        drawHeatMap(salesPriceData, currentYear)
      })
    });

    function mouseover(d) {
      // Highlight hovered borough with orange
      d3.select(this).style("fill", "rgba(255, 165, 0, 0.3)");
      boroughName
        .text(d.properties.boro_name)
        .attr("font-size", "42px")
        .style("font-family", "Arial");
    }

    // reset borough color and text
    function mouseout(d) {
      d3.select(this).style("fill", function (d) {
        return colorMap[d.properties.boro_name];
      });
      boroughName.text("");
    }

    var boroughName = g.append("text").attr("x", 20).attr("y", 45);

    //MAP DRAWING END

    function drawHeatMap(salesPriceData, currentYear) {

      const currentYearData = Object.keys(salesPriceData).map(
        v => [v, salesPriceData[v][String(currentYear)]])

      const priceExtent = d3.extent(Object.keys(salesPriceData)
        .map(v => Object.keys(salesPriceData[v])
          .map(k => Number(salesPriceData[v][k]))).flat())

      const colors = [
        "mediumaquamarine",
        "skyblue",
        "darkcyan",
        "lightsalmon",
        "orchid"
      ]

      //const colorScale = d3.scaleQuantile().domain(priceExtent).range(colors)

      console.log(currentYearData)
    }


  </script>
</body>